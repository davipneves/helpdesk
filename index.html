<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Helpdesk</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="stylesheet" href="style.css">
</head>

<body class="bg-gray-100 font-sans">
    
    <div id="app" class="min-h-screen"></div>
    <div id="modal-container"></div>

    <template id="template-carregando">
        <div class="flex items-center justify-center min-h-screen">
            <div class="spinner"></div>
        </div>
    </template>

    <template id="template-modal-erro">
        <div class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4">
            <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full">
                <h3 class="text-lg font-bold text-red-700 mb-4">Ocorreu um Erro</h3>
                <p class="text-gray-700 mb-6" id="modal-erro-mensagem"></p>
                <button id="modal-erro-fechar" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                    Fechar
                </button>
            </div>
        </div>
    </template>

    <template id="template-login">
        <div class="min-h-screen flex items-center justify-center p-4">
            <div class="max-w-md w-full bg-white rounded-xl shadow-2xl overflow-hidden">
                <div class="p-8">
                    <h2 class="text-3xl font-bold text-center text-gray-800 mb-6">Sistema de Helpdesk</h2>
                    <div class="flex mb-6">
                        <button id="btn-tipo-funcionario" class="w-1/2 py-3 font-semibold transition-all duration-300 bg-blue-600 text-white shadow-md rounded-l-lg">Sou Funcionário</button>
                        <button id="btn-tipo-tecnico" class="w-1/2 py-3 font-semibold transition-all duration-300 bg-gray-200 text-gray-700 hover:bg-gray-300 rounded-r-lg">Sou Técnico</button>
                    </div>
                    <form id="form-login">
                        <div class="mb-4">
                            <label for="email" class="block text-sm font-medium text-gray-700 mb-2" id="label-email">Email de Funcionário</label>
                            <input type="email" id="email" placeholder="seu.email@empresa.com" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"/>
                        </div>
                        <button type="submit" id="btn-login-submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 flex items-center justify-center disabled:opacity-50">Entrar</button>
                        <p id="erro-login" class="text-red-500 text-sm text-center mt-4"></p>
                    </form>
                </div>
                <div class="bg-gray-50 p-6 border-t border-gray-200">
                    <h4 class="text-sm font-semibold text-gray-600 mb-3 text-center">Para Testar:</h4>
                    <p class="text-xs text-gray-500 text-center">Func.: <strong id="email-teste-funcionario" class="text-blue-600 cursor-pointer">ana.silva@empresa.com</strong></p>
                    <p class="text-xs text-gray-500 text-center mt-2">Técnico: <strong id="email-teste-tecnico" class="text-blue-600 cursor-pointer">carlos.souza@empresa.com</strong></p>
                </div>
            </div>
        </div>
    </template>

    <template id="template-header">
         <header class="bg-white shadow-md sticky top-0 z-10">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <h1 class="text-xl font-bold text-blue-600">Helpdesk <span class="font-normal text-gray-600" id="header-titulo-portal"></span></h1>
                    <div class="flex items-center">
                        <span class="text-gray-700 mr-4">Olá, <strong class="font-medium" id="header-nome-usuario"></strong></span>
                        <button id="btn-logout" class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg text-sm transition duration-300">Sair</button>
                    </div>
                </div>
            </div>
        </header>
    </template>

    <template id="template-funcionario-dashboard">
        <main class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
            <div class="mb-6 flex flex-wrap justify-end gap-4">
                <button id="btn-ir-novo-ticket" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition duration-300">&#43; Abrir Novo Chamado</button>
            </div>
            <div class="bg-white shadow-lg rounded-lg overflow-hidden">
                <div class="p-4 sm:p-6"><h3 class="text-lg font-semibold text-gray-800">Meus Chamados Ativos</h3></div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Assunto</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Abertura</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Técnico</th>
                            </tr>
                        </thead>
                        <tbody id="lista-meus-tickets" class="bg-white divide-y divide-gray-200"></tbody>
                    </table>
                </div>
            </div>
        </main>
    </template>

    <template id="template-tecnico-dashboard">
        <main class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8 space-y-8">
            <div class="flex justify-end gap-4">
                <button id="btn-ir-relatorio" class="bg-slate-600 hover:bg-slate-700 text-white font-bold py-2 px-4 rounded-lg shadow-lg transition duration-300">relatório por departamento</button>
                <button id="btn-ir-historico" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow-lg transition duration-300">histórico de tickets</button>
            </div>
            <div class="bg-white shadow-lg rounded-lg overflow-hidden">
                <div class="p-4 sm:p-6"><h3 class="text-lg font-semibold text-gray-800">Meus Chamados Atribuídos (Ativos)</h3></div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Assunto</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Solicitante</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Prioridade</th></tr></thead>
                        <tbody id="lista-tickets-atribuidos" class="bg-white divide-y divide-gray-200"></tbody>
                    </table>
                </div>
            </div>
            <div class="bg-white shadow-lg rounded-lg overflow-hidden">
                <div class="p-4 sm:p-6"><h3 class="text-lg font-semibold text-gray-800">Fila de Chamados Não Atribuídos (Ativos)</h3></div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Assunto</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Solicitante</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Prioridade</th></tr></thead>
                        <tbody id="lista-tickets-nao-atribuidos" class="bg-white divide-y divide-gray-200"></tbody>
                    </table>
                </div>
            </div>
        </main>
    </template>

    <template id="template-novo-ticket">
        <main class="max-w-3xl mx-auto p-4 sm:p-6 lg:p-8 mt-8">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Abrir Novo Chamado</h2>
                <form id="form-novo-ticket">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="md:col-span-2"><label for="assunto" class="block text-sm font-medium text-gray-700">Assunto</label><input type="text" id="assunto" required class="mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" /></div>
                        <div class="md:col-span-2"><label for="descricao" class="block text-sm font-medium text-gray-700">Descrição Detalhada</label><textarea id="descricao" rows="5" required class="mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea></div>
                        <div><label for="departamento" class="block text-sm font-medium text-gray-700">Meu Departamento</label><input type="text" id="departamento" readonly class="mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed focus:outline-none" /></div>
                        <div><label for="palavras_chave" class="block text-sm font-medium text-gray-700">Palavras-chave (separadas por vírgula)</label><input type="text" id="palavras_chave" class="mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" /></div>
                        <div>
                            <label for="urgencia" class="block text-sm font-medium text-gray-700">Urgência</label>
                            <select id="urgencia" class="mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="1">Baixa</option><option value="2" selected>Média</option><option value="3">Alta</option>
                            </select>
                        </div>
                        <div>
                            <label for="impacto" class="block text-sm font-medium text-gray-700">Impacto</label>
                            <select id="impacto" class="mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="1">Baixo</option><option value="2" selected>Médio</option><option value="3">Alto</option>
                            </select>
                        </div>
                    </div>
                    <div class="mt-8 flex justify-end gap-4">
                        <button type="button" id="btn-cancelar-ticket" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-6 rounded-lg transition duration-300">Cancelar</button>
                        <button type="submit" id="btn-submit-ticket" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition duration-300 flex items-center justify-center disabled:opacity-50">Enviar Chamado</button>
                    </div>
                </form>
            </div>
        </main>
    </template>
    
    <template id="template-detalhe-ticket">
        <main class="max-w-5xl mx-auto p-4 sm:p-6 lg:p-8 mt-8">
            <button id="btn-voltar-detalhe" class="mb-6 text-sm font-medium text-blue-600 hover:text-blue-800">&larr; Voltar</button>
            <div id="alerta-ticket-inativo" class="hidden mb-4 p-4 text-sm text-yellow-800 rounded-lg bg-yellow-50" role="alert"><span class="font-medium">Atenção!</span> Este ticket está inativo e não pode ser editado.</div>
            <div class="bg-white shadow-xl rounded-lg overflow-hidden">
                 <div class="bg-gray-50 px-6 py-5 border-b border-gray-200"><h3 class="text-xl font-bold text-gray-900 leading-6" id="detalhe-id">Ticket #...</h3><p class="mt-1 max-w-2xl text-sm text-gray-500" id="detalhe-assunto">...</p></div>
                <div class="grid grid-cols-1 md:grid-cols-3">
                    <div class="md:col-span-2 p-6 border-r border-gray-200"><h4 class="text-lg font-semibold text-gray-800 mb-4">Descrição do Problema</h4><p class="text-gray-700 whitespace-pre-wrap" id="detalhe-descricao">...</p></div>
                    <div class="p-6">
                        <h4 class="text-lg font-semibold text-gray-800 mb-4">Detalhes</h4>
                        <dl class="grid grid-cols-1 gap-y-6">
                            <div><dt class="text-sm font-medium text-gray-500">Solicitante</dt><dd class="mt-1 text-sm text-gray-900" id="detalhe-solicitante">---</dd></div>
                            <div><dt class="text-sm font-medium text-gray-500">Data de Abertura</dt><dd class="mt-1 text-sm text-gray-900" id="detalhe-data">---</dd></div>
                            <div><dt class="text-sm font-medium text-gray-500">Urgência</dt><dd class="mt-1 text-sm text-gray-900" id="detalhe-urgencia">---</dd></div>
                            <div><dt class="text-sm font-medium text-gray-500">Impacto</dt><dd class="mt-1 text-sm text-gray-900" id="detalhe-impacto">---</dd></div>
                            <div id="container-palavras-chave" class="hidden"><dt class="text-sm font-medium text-gray-500">Palavras-chave</dt><dd class="mt-1 text-sm text-gray-900" id="detalhe-palavras-chave">---</dd></div>
                            <div><label for="detalhe-estado" class="block text-sm font-medium text-gray-500">Estado</label><select id="detalhe-estado" disabled class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed focus:outline-none"></select></div>
                            <div><label for="detalhe-prioridade" class="block text-sm font-medium text-gray-500">Prioridade</label><select id="detalhe-prioridade" disabled class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed focus:outline-none"><option value="1">Baixa</option><option value="2">Média</option><option value="3">Alta</option></select></div>
                            <div><label for="detalhe-tecnico" class="block text-sm font-medium text-gray-500">Técnico Atribuído</label><select id="detalhe-tecnico" disabled class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed focus:outline-none"><option value="">Não atribuído</option></select></div>
                        </dl>
                        <button id="btn-salvar-ticket" disabled class="w-full mt-8 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed hidden">Salvar Alterações</button>
                    </div>
                </div>
            </div>
        </main>
    </template>

    <template id="template-historico">
        <main class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
            <div class="mb-4 flex justify-between items-center">
                <h2 class="text-2xl font-bold text-gray-800">Histórico de Tickets</h2>
                <button id="btn-voltar-dashboard-hist" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg transition duration-300">&larr; Voltar ao Dashboard</button>
            </div>
            <div class="mb-6 bg-white p-4 rounded-lg shadow-sm flex flex-wrap gap-x-4 gap-y-2 justify-between items-center">
                <div id="filtros-historico" class="flex flex-wrap gap-2">
                    <button data-filtro="todos" class="filtro-btn bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg">Todos</button>
                    <button data-filtro="dia" class="filtro-btn bg-gray-200 text-gray-700 font-semibold py-2 px-4 rounded-lg">Hoje</button>
                    <button data-filtro="semana" class="filtro-btn bg-gray-200 text-gray-700 font-semibold py-2 px-4 rounded-lg">Esta Semana</button>
                    <button data-filtro="mes" class="filtro-btn bg-gray-200 text-gray-700 font-semibold py-2 px-4 rounded-lg">Este Mês</button>
                    <button data-filtro="ano" class="filtro-btn bg-gray-200 text-gray-700 font-semibold py-2 px-4 rounded-lg">Este Ano</button>
                </div>
                <div class="flex items-center">
                    <input id="check-mostrar-inativos" type="checkbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                    <label for="check-mostrar-inativos" class="ml-2 block text-sm font-medium text-gray-700">Mostrar tickets inativos</label>
                </div>
            </div>
            <div class="bg-white shadow-lg rounded-lg overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Assunto</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data Abertura</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Solicitante</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Técnico</th>
                                <th id="th-acoes" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="lista-historico-tickets" class="bg-white divide-y divide-gray-200"></tbody>
                    </table>
                </div>
            </div>
        </main>
    </template>

    <template id="template-relatorio">
        <main class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
            <div class="mb-4 flex justify-between items-center">
                <h2 class="text-2xl font-bold text-gray-800">Tickets Ativos por Departamento</h2>
                <button id="btn-voltar-dashboard-relatorio" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg transition duration-300">&larr; Voltar ao Dashboard</button>
            </div>
            <div class="bg-white shadow-lg rounded-lg overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ticket</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Assunto</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Solicitante</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Departamento (JOIN)</th>
                            </tr>
                        </thead>
                        <tbody id="lista-relatorio" class="bg-white divide-y divide-gray-200"></tbody>
                    </table>
                </div>
            </div>
        </main>
    </template>

    <script src="script.js"></script>
</body>

</html>